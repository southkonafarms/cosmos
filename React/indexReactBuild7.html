<!DOCTYPE html>

<html>
<head>
<title>React WTF</title>
<script src="../js/react.development.js"></script>
<script src="../js/react-dom.development.js"></script>
</head>
<body>
	<div id="root"></div>
	
	<script type="text/javascript">
	//for debugging
	function print_recursive(printthis) {
	    var output = '';

	    if(Array.isArray(printthis) || typeof(printthis) == 'object') {
	        for(var i in printthis) {
	        	console.log("??:"+printthis[i]+"::"+i);
	            output += i + ' : ' + print_recursive(printthis[i]) + '\n';
	        }
	    }else {
	        output += printthis;
	    }
	    console.log("PRINT:"+output);
	}
	
	/*
	*  parses json message from the server
	*/
	var parseJson = (function (){
		// private
		var lineArray;
		var lineCount;
		var state;
		// public
			return{
				parseStart: function(json){
					lineArray = [];
					lineCount = 0;
					output = '';
					return parseJson.parse(json);
				},
				parse: function(json){
					if(Array.isArray(json) || typeof(json) == 'object') {
						for(var idex in json) {
							console.log("Next idex:" + idex);
				        	switch(idex){
				        	case "createMessageResponse":
				        		state = 'Start0';
				        		break;
				        	case "theMessage":
				        		state = 'Start1';
				        		break;
				        	default:
				        	}
			        	}
						parseJson.parse(json[idex]);
					}else{
						switch (state){
						case 'Start0':
							console.log("json0:" + json);
							break;
						case 'Start1':
							console.log("json1:" + json);
							if(json === 'Exists'){
								lineArray = 'Exists';
							}
							else{
								if(json.includes('SystemUV')){
									lineArray = json;
								}
							}
							break;
						}	
					}	
					return lineArray;
				}
			}
		}
	)();
	
	/**
		The current working dimension of the System
		
		This object must be instantiated
	*/
	var UVworkingDimension = (function (){
			// private
			var uDimension;
			var vDimension;
			// public
			return{
				instance: function (udim, vdim){
					uDimension = udim;
					vDimension = vdim;
				},
				getUdim: function(){
					return uDimension;
				},
				getVdim: function(){
					return vDimension;
				}
			}
		}
	);
	
	
	</script>

	<script>
	
            window.onload = function()
      /*0*/      {
            	class NameForm extends React.Component {  /*1*/
            		  constructor(props) { /*2*/
            		    super(props);
            		    this.state = { /*3*/
            		      uDim: '',
            		      submitted: false
            		    }; /*3*/
            		    this.handleChange = this.handleChange.bind(this);
            		    this.handleSubmit = this.handleSubmit.bind(this);
            		  } /*2*/

            		  handleChange(event) { /*2 */
            		    const regexpr = /^[0-9\b]+$/;

            		    if (event.target.value === '' || regexpr.test(event.target.value)) { /* 3 */
            		      this.setState({ /* 4 */
            		       uDim: event.target.value
            		      }); /* 4 */
            		    } /* 3 */
            		  } /* 2 */

            		  handleSubmit(event) { /* 2 */
            		    event.preventDefault();
            		    const { /* 3 */
            		      value
            		    } = this.state; /* 3 */
            		    alert('U dimension was submitted: ' + this.state.uDim);
            		    this.setState({ /* 3 */
            		      submitted: true
            		    }); /* 3 */
            		  } /* 2 */
            		  
            		  render() { /* 2 */
            				    return this.state.submitted ? /*#__PURE__*/React.createElement(NameProcess, { /* 3 */
            				      value: this.state.uDim
            				    }) : 
            				    	 /*#__PURE__*/React.createElement("form", { /* 3 */ /* 3 */ 
            				           onSubmit: this.handleSubmit
            				    }, 
            				    /*#__PURE__*/React.createElement("label", null, "U Dimension:"), /*#__PURE__*/React.createElement("input", { /* 3 */ /* 3 */ 
            				      type: "text",
            				      value: this.state.uDim,
            				      onChange: this.handleChange
            				    }), 
            				    /*#__PURE__*/React.createElement("input", { /* 3 */ /* 3 */ 
            				      type: "submit",
            				      value: "Submit"
            				    })); /* 3 */ 
            				  } /* 2 */
            		  } /* 1 */
            		  
            		  class NameProcess extends React.Component {  /*1*/
                		  constructor(props) { /*2*/
                		    super(props);
                		    this.state = { /*3*/
                		    	  uDim: this.props.value,
                      		      vDim: '',
                      		      submitted: false
                      		    }; /*3*/
                      		    this.handleChange = this.handleChange.bind(this);
                      		    this.handleSubmit = this.handleSubmit.bind(this);
                  		  } /*2*/

                		  handleChange(event) { /*2 */
                  		    const regexpr = /^[0-9\b]+$/;

                  		    if (event.target.value === '' || regexpr.test(event.target.value)) { /* 3 */
                  		      this.setState({ /* 4 */
                  		       vDim: event.target.value
                  		      }); /* 4 */
                  		    } /* 3 */
                  		  } /* 2 */

                  		  handleSubmit(event) { /* 2 */
                  		    event.preventDefault();
                  		    const { /* 3 */
                  		      value
                  		    } = this.state; /* 3 */
                  		    alert('V dimension was submitted: ' + this.state.vDim);
                  		    this.setState({ /* 3 */
                  		      submitted: true
                  		    }); /* 3 */
                  		  } /* 2 */
                  		  
						  render(){ /* 2 */
          				    return this.state.submitted ? /*#__PURE__*/React.createElement(AjaxProcess, { /* 3 */
          				      value: this.state.uDim + ':' +this.state.vDim
          				    }) : 
          				    	 /*#__PURE__*/React.createElement("form", { /* 3 */ /* 3 */ 
          				           onSubmit: this.handleSubmit
          				    }, 
          				    /*#__PURE__*/React.createElement("label", null, "V Dimension:"), /*#__PURE__*/React.createElement("input", { /* 3 */ /* 3 */ 
          				      type: "text",
          				      value: this.state.vDim,
          				      onChange: this.handleChange
          				    }), 
          				    /*#__PURE__*/React.createElement("input", { /* 3 */ /* 3 */ 
          				      type: "submit",
          				      value: "Submit"
          				    })); /* 3 */ 
          				  } /* 2 */
                   	  } /* 1 */
                   	  
                   	  class AjaxProcess extends React.Component {  /*1*/
                   		  
                   		constructor(props) { /*2*/
                   		 super(props);
                   		this.state = { /*3*/
              		    	theProps: this.props.value,
              		        error: null,
              		      	isLoaded: false,
              		      	items: '',
              		      	dims: this.props.value.split(':')
						    }; /*3*/
                   	    } /* 2 */
                   	    
                   	 componentDidMount() { /* 2 */
                   	    fetch("http://www.localhost:8080/johntredden-1.0/userDesignatedSystem.html?udimension=" + this.state.dims[0] + "&vdimension="+ this.state.dims[1]).then(res => res.json()).then(result => { /* 3 */
                   	      this.setState({  /* 4 */
                   	        isLoaded: true,
                   	        items: result
                   	      });  /* 4 */
                   	   	  alert("items:"+ result);
                   	    }, /* 3 */
                   	    // Note: it's important to handle errors here
                   	    // instead of a catch() block so that we don't swallow
                   	    // exceptions from actual bugs in components.
                   	    error => { /* 3 */
                   	      this.setState({ /* 4 */
                   	        isLoaded: true,
                   	        error
                   	      }); /* 4 */
                   	    }); /* 3 */
                   	  } /* 2 */
                   		
                   	    render(){ /* 2 */
                   			// alert('combined props: ' + this.state.theProps);
                   			const {
                   		      error,
                   		      isLoaded,
                   		      items
                   		    } = this.state;

                   		    if (error) {
                   		      return /*#__PURE__*/React.createElement("div", null, "Error: ", error.message);
                   		    } else if (!isLoaded) {
                   		      return /*#__PURE__*/React.createElement("div", null, "Loading...");
                   		    } else {
                   		    	// print_recursive(this.state.items);
                   		    	var response = parseJson.parseStart(this.state.items);
                   		    	if(response === 'Exists'){
                   		    		alert(" System Ucoordinate " + this.state.dims[0] + " Vcoordinate" + this.state.dims[1] 
                   		    		+ " allready exists, choose different U and V coordinates");
                   		    		return React.createElement(NameForm, null);
                   		    	}
                   		    	else{
                   		    		var serverDims = response.split(':');
                   		    		var workingUVworkingDimension = new UVworkingDimension();
                   		    		workingUVworkingDimension.instance(serverDims[1], serverDims[2]);
                   		    		alert("working UV:" + serverDims[1] + " " + serverDims[2]);
                   		    	}
                   		    	return 'Udim:' + this.state.dims[0] + ' Vdim:' + this.state.dims[1] + " response:" + response;
                   		    }/* 2 */
                   	    		
                   	    }
                   	  } /* 1 */

            	ReactDOM.render( /*#__PURE__*/React.createElement(NameForm, null), document.getElementById('root'));           	
            	} /* 0 */
            
        </script>
</body>
</html>